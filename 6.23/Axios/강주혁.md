# Axios

## Axiosë€?

> Promise based HTTP client for the browser and node.js

- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•œ `ë¹„ë™ê¸° í†µì‹ ` ë¼ì´ë¸ŒëŸ¬ë¦¬

## ê¸°ëŠ¥

- ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•´ `XMLHttpRequests` ìƒì„±
- node.jsë¥¼ ìœ„í•´ `http` ìš”ì²­ ìƒì„±
- `Promise API`ë¥¼ ì§€ì›
- ìš”ì²­ ë° ì‘ë‹µ `ì¸í„°ì…‰íŠ¸`
- ìš”ì²­ ë° ì‘ë‹µ ë°ì´í„° ë³€í™˜
- ìš”ì²­ ì·¨ì†Œ
- JSON ë°ì´í„° ìë™ ë³€í™˜
- `XSRF`ë¥¼ ë§‰ê¸°ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì§€ì›

```js
// lib/adapters/xhr.js
export default isXHRAdapterSupported &&
  function (config) {
    return new Promise(function dispatchXhrRequest(resolve, reject) {
      let requestData = config.data;
      const requestHeaders = AxiosHeaders.from(config.headers).normalize();
      const responseType = config.responseType;

      let request = new XMLHttpRequest();

      // HTTP basic authentication
      if (config.auth) {
        const username = config.auth.username || '';
        const password = config.auth.password
          ? unescape(encodeURIComponent(config.auth.password))
          : '';
        requestHeaders.set('Authorization', 'Basic ' + btoa(username + ':' + password));
      }

      const fullPath = buildFullPath(config.baseURL, config.url);

      request.open(
        config.method.toUpperCase(),
        buildURL(fullPath, config.params, config.paramsSerializer),
        true
      );

      //...

      // Send the request
      request.send(requestData || null);
    });
  };
```

```js
// lib/adapters/http.js
const wrapAsync = (asyncExecutor) => {
  return new Promise((resolve, reject) => {
    let onDone;
    let isDone;

    const done = (value, isRejected) => {
      if (isDone) return;
      isDone = true;
      onDone && onDone(value, isRejected);
    }

    const _resolve = (value) => {
      done(value);
      resolve(value);
    };

    const _reject = (reason) => {
      done(reason, true);
      reject(reason);
    }

    asyncExecutor(_resolve, _reject, (onDoneHandler) => (onDone = onDoneHandler)).catch(_reject);
  })
};

export default isHttpAdapterSupported && function httpAdapter(config) {
  return wrapAsync(async function dispatchHttpRequest(resolve, reject, onDone) {
    //...
  }
}
```

Axiosì˜ ì½”ë“œë¥¼ ë³´ë©´, Browserì™€ Node.js ë‘˜ ë‹¤ Promiseë¡œ ê°ì‹¸ì ¸ ìˆê³ , ê°ê° XMLHttpRequestì™€ httpë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

Promiseë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ë™ê¸° í†µì‹ ì„ í•˜ê³  ìˆë‹¤. ê·¸ë˜ì„œ return ê°’ìœ¼ë¡œ Promiseë¥¼ ë°˜í™˜í•œë‹¤.

## XMLHttpRequest VS Fetch API

### XMLHttpRequest

#### ì¥ì 

- í˜¸í™˜ì„± ë›°ì–´ë‚¨

  - ë¸Œë¼ìš°ì ¸ê°€ êµ¬ë²„ì ¼ì´ë“  ì‹ ë²„ì ¼ì´ë“  ìƒê´€ì—†ì´ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

- Response Timeout

  - timeoutì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
  - FetchëŠ” [`AbortController`](https://developer.mozilla.org/ko/docs/Web/API/AbortController) interfaceë¥¼ í™œìš©í•´ì„œ êµ¬í˜„í•´ì•¼ í•œë‹¤.

  ```js
  // Axios
  axios({
    method: 'post',
    url: '/login',
    timeout: 4000,
    data: {
      firstName: 'dy',
      lastName: 's',
    },
  })
    .then((response) => {
      /* handle the response */
    })
    .catch((error) => console.error('timeout exceeded'));

  // Fetch
  const controller = new AbortController();
  const options = {
    method: 'POST',
    signal: controller.signal,
    body: JSON.stringify({
      firstName: 'dy',
      lastName: 's',
    }),
  };
  const promise = fetch('/login', options);
  const timeoutId = setTimeout(() => controller.abort(), 4000);

  promise
    .then((response) => {
      /* handle the response */
    })
    .catch((error) => console.error('timeout exceeded'));
  ```

- ìë™ JSON í˜• ë³€í™˜

  - Axios ì˜ ê²½ìš° ë³„ë„ì˜ í˜• ë³€í™˜ ì—†ì´ JSON íƒ€ì…ì˜ ë°ì´í„°ë¡œ ì•Œì•„ì„œ stringify í•´ì¤€ë‹¤.
  - fetch ì˜ ê²½ìš° ì§ì ‘ JSON í˜•íƒœë¡œ ë³€í™˜í•´ì¤˜ì•¼ í•œë‹¤.

- HTTPInterceptor
  - ìš”ì²­ê³¼ ì‘ë‹µì„ ì¸í„°ì…‰íŠ¸ í•  ìˆ˜ ìˆë‹¤.

#### ë‹¨ì 

- XHR ë„ˆë¬´ ì˜¤ë˜ëë‹¤..
- XHRì€ ê°€ë…ì„± ë–¨ì–´ì§, Promiseë¥¼ ì§ì ‘ ê°ì‹¸ì•¼ í•¨ -> Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- axios(XHR)ì€ fetchì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë²ˆë“¤ ì‚¬ì´ì¦ˆê°€ ë¬´ê±°ì›Œì§€ëŠ” ê²½í–¥ì´ ìˆë‹¤.

### Fetch

#### ì¥ì 

- ë¸Œë¼ìš°ì € ë‚´ì¥ API
  - fetchëŠ” ë¸Œë¼ìš°ì € ë‚´ì¥ APIì´ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ë‹¤.
- Cache API
  - ìš”ì²­ì´ë‚˜ ì‘ë‹µì— ëŒ€í•´ì„œ ë©”ëª¨ë¦¬ì— ì˜¤ë˜ ë‚¨ë„ë¡ ìºì‹±í•  ìˆ˜ ìˆë‹¤.
  - `default`: ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì˜ ìºì‹œ ë©”ì»¤ë‹ˆì¦˜ì„ ë”°ë¥¸ë‹¤. ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ìºì‹œì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©°, ìºì‹œì— ì €ì¥ëœ ë¦¬ì†ŒìŠ¤ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì„œë²„ë¡œ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
  - `no-store`: ìºì‹œì— ë¦¬ì†ŒìŠ¤ë¥¼ ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ë§¤ë²ˆ ìš”ì²­ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ ì„œë²„ë¡œë¶€í„° ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.
  - `reload`: ë¸Œë¼ìš°ì €ëŠ” ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  í•­ìƒ ì„œë²„ë¡œë¶€í„° ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
  - `no-cache`: ë¦¬ì†ŒìŠ¤ë¥¼ ìºì‹œí•  ìˆ˜ ìˆì§€ë§Œ, ì„œë²„ì— ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš”ì²­í•˜ì—¬ ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ì¸ì§€ í™•ì¸í•œë‹¤. ì„œë²„ê°€ ë¦¬ì†ŒìŠ¤ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŒì„ ì•Œë ¤ì£¼ë©´ ìºì‹œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©°, ë³€ê²½ë˜ì—ˆë‹¤ê³  ì•Œë ¤ì£¼ë©´ ì„œë²„ì—ì„œ ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
  - `force-cache`: ë¸Œë¼ìš°ì €ëŠ” ìºì‹œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³ , ì„œë²„ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì„œë²„ê°€ ì‘ë‹µ í—¤ë”ì— ìºì‹œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•˜ì§€ ë§ë¼ëŠ” ì§€ì‹œë¥¼ ë‚´ë¦¬ì§€ ì•ŠëŠ” í•œ, í•­ìƒ ìºì‹œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.
- Policy Control
  - Cross Origin Resource Sharing(CORS)ì´ë‚˜ ìœ„ì—ì„œ ë‚˜ì™”ë˜ Cacheë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆë‹¤.
- Stream
  - fetchëŠ” streamì„ ì§€ì›í•˜ì§€ë§Œ, XHRì€ ì‘ë‹µ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ë²„í¼ë§í•œë‹¤.

## Fetchë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ - ky

> Ky is a tiny and elegant HTTP client based on the browser Fetch API

<img width="1311" alt="image" src="https://github.com/Self-Driven-Development/Dogsounds-TIL/assets/23312485/58fa3328-e2fa-4964-a6c1-ec65c1e91523" />

### ê¸°ëŠ¥

- ë” ê°„ë‹¨í•œ API
- ë©”ì„œë“œ ë‹¨ì¶•í‚¤(ky.post())
- 2xxê°€ ì•„ë‹Œ ìƒíƒœ ì½”ë“œë¥¼ ì˜¤ë¥˜ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤(ë¦¬ë””ë ‰ì…˜ í›„).
- ì‹¤íŒ¨í•œ ìš”ì²­ ì¬ì‹œë„
- JSON ì˜µì…˜
- timeout ì§€ì›
- URL prefix ì˜µì…˜
- ì‚¬ìš©ì ì •ì˜ ê¸°ë³¸ê°’ì´ ìˆëŠ” instance
- Hooks

ê¸°ì¡´ì˜ fetchë¥¼ ì‚¬ìš©í•  ë•Œ, ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í–ˆë‹¤.

```js
class HTTPError extends Error {}

const response = await fetch('https://example.com', {
  method: 'POST',
  body: JSON.stringify({ foo: true }),
  headers: {
    'content-type': 'application/json',
  },
});

if (!response.ok) {
  throw new HTTPError(`Fetch error: ${response.statusText}`);
}

const json = await response.json();

console.log(json);
//=> `{data: 'ğŸ¦„'}`
```

í•˜ì§€ë§Œ kyë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```js
import ky from 'ky';

const json = await ky.post('https://example.com', { json: { foo: true } }).json();

console.log(json);
//=> `{data: 'ğŸ¦„'}`
```

ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ ì˜µì…˜ë“¤ì„ ì œê³µí•˜ê³  ìˆì–´ì„œ, fetchë¥¼ ì‚¬ìš©í•  ë•Œë³´ë‹¤ í›¨ì”¬ ê°„ë‹¨í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

ëŒ€ì‹ , browserì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, node.jsì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `ky-universal`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ì¶œì²˜

- [Axios ì™€ Fetch](https://sdy-study.tistory.com/38)
- [fetchì™€ axiosì˜ ì°¨ì´ì ](https://junghyeonsu.com/posts/fetch-vs-axios/)
