# Excution Context (ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸)

> ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ ì‹¤í–‰ë˜ê³  ì—°ì‚°ë˜ëŠ” ë²”ìœ„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¶”ìƒì ì¸ ê°œë…

ì½”ë“œë“¤ì´ ì‹¤í–‰ë˜ê¸° ìœ„í•œ í™˜ê²½ì´ì í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

## Types of Execution Context

- Execution Context (EC, ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸)
  - Global Execution Context (GEC, ì „ì—­ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸)
  - Functional Execution Context (FEC, í•¨ìˆ˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸)
  - Execution Context inside eval function (Eval ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸)

### Global Execution Context (GEC)

> ê°€ì¥ ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸

ì „ì—­ ì»¨í…ìŠ¤íŠ¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ ìƒì„±ëœë‹¤.

GECëŠ” ë‹¨ í•˜ë‚˜ë§Œ ì¡´ì¬í•´ì•¼ í•œë‹¤. (JSëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œì´ê¸° ë•Œë¬¸ì—)

1. `window` global object ìƒì„±
2. `this`ì— global object ì°¸ì¡°

### Functional Execution Context (FEC)

> í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ ìƒì„±

ê° í•¨ìˆ˜ë³„ë¡œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ ë§Œë“¤ì–´ì§„ë‹¤.

## Execution Context Stack (ECS)

> ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ìŒ“ì´ëŠ” ìŠ¤íƒ

ë§¨ ì²˜ìŒ ìŠ¤íƒì— ìŒ“ì´ëŠ” ì»¨í…ìŠ¤íŠ¸ëŠ” GECì´ë‹¤.
ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ FECê°€ ìƒì„±ë˜ë©´ ìŠ¤íƒì— ìŒ“ì´ê³ , ì‹¤í–‰ì´ ëë‚˜ë©´ ìŠ¤íƒì—ì„œ ì œê±°ëœë‹¤.
ëª¨ë“  js ì½”ë“œê°€ ì‹¤í–‰ì´ ëë‚˜ì•¼ GECê°€ ìŠ¤íƒì—ì„œ ì œê±°ëœë‹¤.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FGIQ4w%2FbtqLxv0VNNO%2FQ93UvbJWmnAtKxoPJX2kxK%2Fimg.png)

## Execution Context êµ¬ì„±

```js
ExecutionContext: {
    LexicalEnvironment: {
        Environment Records,
        Reference to the outer environment,
    },
    VariableEnvironment: {
        Environment Records,
        Reference to the outer environment,
    }
    ThisBinding
}
```

### Lexical Environment & Variable Environment

> Variable EnvironmentëŠ” Lexical Environmentë¥¼ ìƒì†í•˜ëŠ” ê´€ê³„  
> Variable Environmentê³¼ Lexical Environment ê°ê° ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ë“¤ì„ ê´€ë¦¬í•¨

- Lexical Environment

  - `letê³¼ constë¡œ ì„ ì–¸ëœ ë³€ìˆ˜`ë“¤ì„ ìœ„í•œ `local lexical scope`ë¥¼ ë‹¨ìœ„ë¡œ í•¨
  - let, constë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ê°€ ë©”ëª¨ë¦¬ì— ë§¤í•‘, `ì´ˆê¸°ê°’ í• ë‹¹ X`
  - í•¨ìˆ˜ì„ ì–¸ì‹ìœ¼ë¡œ ì„ ì–¸ëœ í•¨ìˆ˜ê°€ ë©”ëª¨ë¦¬ì— ë§¤í•‘

- Variable Environment

  - `varë¡œ ì„ ì–¸ëœ ë³€ìˆ˜`ë“¤ì„ ìœ„í•œ `function scope`ë¥¼ ë‹¨ìœ„ë¡œ í•¨
  - varë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ê°€ ë©”ëª¨ë¦¬ì— ë§¤í•‘, ì´ˆê¸°ê°’ìœ¼ë¡œ `undefined`ê°€ í• ë‹¹

ê³µí†µëœ ë‚´ë¶€ ì†ì„±ì„ ì•Œì•„ë³´ì.

### Environment Records (í™˜ê²½ ë ˆì½”ë“œ)

> Environment RecordëŠ” ECMAScript ì½”ë“œì˜ lexical nesting structureë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • ë³€ìˆ˜ ë° í•¨ìˆ˜ì— ëŒ€í•œ ì‹ë³„ì ì—°ê´€ì„±ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì‚¬ì–‘ ìœ í˜•ì…ë‹ˆë‹¤.  
> ì¼ë°˜ì ìœ¼ë¡œ Environment RecordëŠ” FunctionDeclaration, BlockStatement, TryCatch ë“± ECMAScript ì½”ë“œì˜ íŠ¹ì • êµ¬ë¬¸ êµ¬ì¡°ì™€ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì½”ë“œê°€ í‰ê°€ë  ë•Œë§ˆë‹¤ í•´ë‹¹ ì½”ë“œì— ì˜í•´ ìƒì„±ëœ ì‹ë³„ì ë°”ì¸ë”©ì„ ê¸°ë¡í•˜ê¸° ìœ„í•´ ìƒˆ í™˜ê²½ ë ˆì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤. â€” [ECMAscript](https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html)

í•¨ìˆ˜ì™€ ë³€ìˆ˜, this, super ë“± `ìŠ¤ì½”í”„ ë‚´ì—ì„œ ì„ ì–¸ëœ ì‹ë³„ì`ë¥¼ í”„ë¡œí¼í‹°ë¡œ ì €ì¥í•˜ëŠ” ê°ì²´

ëª¨ë“  í™˜ê²½ ë ˆì½”ë“œì—ëŠ” `[[OuterEnv]]` í•„ë“œë¥¼ ê°€ì§€ê³  ìˆë‹¤. (reference to an outer Environment Record)

<br />

í™˜ê²½ ë ˆì½”ë“œëŠ” ì¶”ìƒ í´ë˜ìŠ¤ë¡œì„œ ì„¸ ê°œì˜ êµ¬ì²´ì ì¸ í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆë‹¤.

í•¨ìˆ˜ í™˜ê²½ ë ˆì½”ë“œì™€ ëª¨ë“ˆ í™˜ê²½ ë ˆì½”ë“œëŠ” ì„ ì–¸ì  í™˜ê²½ ë ˆì½”ë“œì˜ ì„œë¸Œí´ë˜ìŠ¤ì´ë‹¤.

```ts
interface EnvironmentRecord {
  DeclarativeEnvironmentRecord: FunctionEnvironmentRecord & ModuleEnvironmentRecord;
  ObjectEnvironmentRecord: ObjectEnvironmentRecord;
  GlobalEnvironmentRecord: GlobalEnvironmentRecord;
}
```

#### Declarative Environment Record (ì„ ì–¸ì  í™˜ê²½ ë ˆì½”ë“œ)

> ì‹ë³„ì ë°”ì¸ë”©ì„ ECMAScript ì–¸ì–´ ê°’ì— ì§ì ‘ ì—°ê²°í•˜ëŠ” FunctionDeclarations, VariableDeclarations ë° Catch ì ˆê³¼ ê°™ì€ ECMAScript ì–¸ì–´ êµ¬ë¬¸ ìš”ì†Œì˜ íš¨ê³¼ë¥¼ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.

`ìŠ¤ì½”í”„ ë‚´ì—ì„œ ì„ ì–¸ëœ ì‹ë³„ì`ë¥¼ ê´€ë¦¬í•¨

- Function Environment Record (í•¨ìˆ˜ í™˜ê²½ ë ˆì½”ë“œ)

  - í•¨ìˆ˜ í™˜ê²½ ë ˆì½”ë“œëŠ” ECMAScript í•¨ìˆ˜ ê°ì²´ì˜ í˜¸ì¶œì— í•´ë‹¹í•˜ë©° í•´ë‹¹ í•¨ìˆ˜ ë‚´ì˜ ìµœìƒìœ„ ì„ ì–¸ì— ëŒ€í•œ ë°”ì¸ë”©ì„ í¬í•¨í•œë‹¤. this ë°”ì¸ë”©ì„ ìƒˆë¡œ ì„¤ì •í•  ìˆ˜ë„ ìˆë‹¤. ë˜í•œ super ë©”ì„œë“œ í˜¸ì¶œì„ ì§€ì›í•˜ëŠ” ë° í•„ìš”í•œ ìƒíƒœë¥¼ ìº¡ì²˜í•œë‹¤.

- Module Environment Record (ëª¨ë“ˆ í™˜ê²½ ë ˆì½”ë“œ)
  - ëª¨ë“ˆ í™˜ê²½ ë ˆì½”ë“œì—ëŠ” ëª¨ë“ˆì˜ ìµœìƒìœ„ ì„ ì–¸ì— ëŒ€í•œ ë°”ì¸ë”©ì´ í¬í•¨ë˜ì–´ ìˆë‹¤. ë˜í•œ ëª¨ë“ˆì´ ëª…ì‹œì ìœ¼ë¡œ ì„í¬íŠ¸í•œ ë°”ì¸ë”©ë„ í¬í•¨ëœë‹¤. ê·¸ `[[OuterEnv]]`ëŠ” ê¸€ë¡œë²Œ í™˜ê²½ ë ˆì½”ë“œì´ë‹¤.

```ts
type DeclarativeEnvironmentRecord = {
  HasBinding(N: string): boolean; //Determines if an environment record has a binding for the string N.
  CreateMutableBinding(N: string, D: boolean): void; //Creates a new mutable binding in an environment record.
  CreateImmutableBinding(N: string, S: boolean): void; //Creates a new immutable binding in an environment record.
  InitializeBinding(N: string, V: any): void; //Initializes an immutable binding in an environment record.
  SetMutableBinding(N: string, V: any, S: boolean): void; //Sets the value of an existing mutable binding in an environment record.
  GetBindingValue(N: string, S: boolean): any; //Retrieves the value of an existing binding from an environment record.
  DeleteBinding(N: string): boolean; //Removes a binding from an environment record.
  HasThisBinding(): boolean; //Determines if an environment record establishes a this binding.
  HasSuperBinding(): boolean; //Determines if an environment record establishes a super binding.
  WithBaseObject(): Object; //Returns the binding object for environments that provide ThisBinding.
};

type FunctionEnvironmentRecord = {
  BindThisValue(V: any): void; //Set the [[ThisValue]] and record that it has been initialized.
  GetThisBinding(): any; //Return the value of this Environment Record's this binding. Throws a ReferenceError if the this binding has not been initialized.
  GetSuperBase(): Object | undefined; //Return the object that is the base for super property accesses bound in this Environment Record. The value undefined indicates that such accesses will produce runtime errors.
};

type ModuleEnvironmentRecord = {
  CreateImportBinding(N: string, M: Module, N2: string): void; //Create an immutable indirect binding in a Module Environment Record. The String value N is the text of the bound name. M is a Module Record, and N2 is a binding that exists in M's Module Environment Record.
  GetThisBinding(): undefined; //Return the value of this Environment Record's this binding.
};
```

#### Object Environment Record (ê°ì²´ í™˜ê²½ ë ˆì½”ë“œ)

withë¬¸ì˜ íš¨ê³¼ë¥¼ ì •ì˜í•˜ëŠ” ë‚´ìš©ì´ Object Environment Recordì— ë‹´ê²¨ ìˆë‹¤

```ts
type ObjectEnvironmentRecord = {
  BindingObject: Object; //The binding object of this Environment Record.
  isWithEnvironment: boolean; //Indicates whether this Environment Record is created for a with statement
};
```

- BindingObject(ì „ì—­ ê°ì²´)ì™€ ì—°ê²°ë¨

- Global Environment Record (ì „ì—­ í™˜ê²½ ë ˆì½”ë“œ)

  - ë¹ŒíŠ¸ì¸ ì „ì—­ ê°ì²´, ì „ì—­ ê°ì²´ì˜ í”„ë¡œí¼í‹° ë° ìŠ¤í¬ë¦½íŠ¸ ë‚´ì˜ ëª¨ë“  ìµœìƒìœ„ ì„ ì–¸ì— ëŒ€í•œ ë°”ì¸ë”©ì„ ì €ì¥í•¨

### Reference to the outer environment (ì™¸ë¶€ í™˜ê²½ì— ëŒ€í•œ ì°¸ì¡°)

lexical scope(ì •ì  ìŠ¤ì½”í”„)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ scopeì˜ lexical environmentë¥¼ ì°¸ì¡°í•œë‹¤.

ê° ì°¸ì¡°ëŠ” ë‹¨ë°©í–¥ ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ë¡œ ì—°ê²°ë˜ì–´ ìˆë‹¤.

### This Binding (this ë°”ì¸ë”©)

- Global Execution Context
  - thisëŠ” ì „ì—­ ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤.
- Functional Execution Context
  - thisëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤.
  - arrow functionì€ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•  ë•Œ thisì— ë°”ì¸ë”©í•  ê°ì²´ê°€ ì •ì ìœ¼ë¡œ ê²°ì •ëœë‹¤.(ìƒìœ„ ìŠ¤ì½”í”„ì˜ thisë¥¼ ì°¸ì¡°)

![](https://mblogthumb-phinf.pstatic.net/MjAyMjAyMjNfMjAg/MDAxNjQ1NTUwMjY4NTk2.cRBGb-t0SureofBB4PVXPK_vt5IM3T8d70W1AsTDKUsg.IG1dMA_7sLjD5GB9eI6kPjjcRZFjqB5lnNW5IjNeHRMg.PNG.dlaxodud2388/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2022-02-23_%EC%98%A4%EC%A0%84_2.17.44.png?type=w800)

## ğŸ¤” ì™œ Lexical Environmentì™€ Variable Environmentê°€ ë¶„ë¦¬ë˜ì–´ ìˆì„ê¹Œ?

### ì²« ë²ˆì§¸ ì´ìœ  - ìŠ¤ì½”í”„

let, constë¡œ ì„ ì–¸í•œ ë³€ìˆ˜ë“¤ì˜ ê²½ìš° ìŠ¤ì½”í”„ê°€ block scopeì´ë‹¤.

varë¡œ ì„ ì–¸í•œ ë³€ìˆ˜ë“¤ì˜ ê²½ìš° ìŠ¤ì½”í”„ê°€ function scopeì´ë‹¤.

ë§Œì•½, í•œ í•¨ìˆ˜ ì•ˆì— ì—¬ëŸ¬

## Execution Context Phases

- Phase
  - Creation Phase
  - Execution Phase

### Creation Phase

1. Lexical Environment ìƒì„±
2. Variable Environment ìƒì„±
3. this ë°”ì¸ë”©

âš ï¸ ê°’ì´ ë³€ìˆ˜ì— í• ë‹¹ë˜ì§€ ì•Šê³  ë©”ëª¨ë¦¬ì— ë§¤í•‘ë§Œ ë˜ì–´ìˆëŠ” ìƒíƒœ

- `var`ë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ëŠ” `undefined`ë¡œ ì´ˆê¸°í™”
- `let`ê³¼ `const`ë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ëŠ” `ì´ˆê¸°í™” X`

### Execution Phase

ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ì‹¤ì œ ê°’ì´ í• ë‹¹ëœë‹¤.

ì˜ˆì‹œ

```js
var a = 3;
let b = 4;

function func(num) {
  var t = 9;
  console.log(a + b + num + t);
}

var r = func(4);
```

<table>
<tr>
<td>creation phase</td>
<td>execution phase</td>
</tr>
<tr>
<td>

```js
// GEC's creation phase
GEC {
	ThisBinding: window,
	LexicalEnvironment: {
		EnvironmentRecord: {
			b: <uninitialized>,
			func: func(){...}
		},
		outer: null
	},
	VariableEnvironment: {
		EnvironmentRecord: {
			a: undefined,
			r: undefined
		},
		outer: null
	}
}
```

</td>
<td>

```js
// GEC's execution phase
GEC {
	ThisBinding: window,
	LexicalEnvironment: {
		EnvironmentRecord: {
			b: 4,
			func: func(){...}
		},
		outer ì°¸ì¡°: null
	},
	VariableEnvironment: {
		EnvironmentRecord: {
			a: 3,
			r: undefined
		},
		outer ì°¸ì¡°: null
	}
}
```

</td>
</tr>
<tr>
<td>

```js
// func's creation phase
FEC {
	ThisBinding: window,
	LexicalEnvironment: {
		EnvironmentRecord: {
			arguments: { num: 4, length: 1 },
		},
		outer: GECì˜ LexicalEnvironment
	},
	VariableEnvironment: {
		EnvironmentRecord: {
			t: undefined
		},
		outer: GECì˜ LexicalEnvironment
	}
}
```

</td>
<td>

```js
// func's execution phase
FEC {
	ThisBinding: window,
	LexicalEnvironment: {
		EnvironmentRecord: {
			arguments: { num: 4, length: 1 },
		},
		outer: GECì˜ LexicalEnvironment
	},
	VariableEnvironment: {
		EnvironmentRecord: {
			t: 9
		},
		outer: GECì˜ LexicalEnvironment
	}
}
```

</td>
</tr>

</table>

FECê°€ ìŠ¤íƒì—ì„œ ì œê±°ë˜ê³  GECì˜ `r`ì´ 20ìœ¼ë¡œ ì´ˆê¸°í™”ëœë‹¤.

```js
GEC {
	ThisBinding: window,
	LexicalEnvironment: {
		EnvironmentRecord: {
			b: 4,
			func: func(){...}
		},
		outer ì°¸ì¡°: null
	},
	VariableEnvironment: {
		EnvironmentRecord: {
			a: 3,
			r: 20
		},
		outer ì°¸ì¡°: null
	}
}
```

![](https://miro.medium.com/v2/resize:fit:1100/1*SBP65hdVDW5j0LuVryTiXw.gif)

ì¶œì²˜

- [JavaScript ì‹ë³„ì ì°¾ê¸° ëŒ€ëª¨í—˜](https://homoefficio.github.io/2016/01/16/JavaScript-%EC%8B%9D%EB%B3%84%EC%9E%90-%EC%B0%BE%EA%B8%B0-%EB%8C%80%EB%AA%A8%ED%97%98)
- [ecma262/Executable Code and Execution Contexts](https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html)
